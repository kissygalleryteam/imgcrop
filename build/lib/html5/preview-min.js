KISSY.add("kg/imgcrop/2.0.0/lib/html5/preview",["node","base"],function(t,i,a,e){"use strict";var n=i("node"),s=i("base"),c=n.all;e.exports=s.extend({initializer:function(){this.canvas=c("<canvas>"),this.ctx=this.canvas[0].getContext("2d"),this._init()},_init:function(){this.container=c(this.get("previewEl")),this._build()},_build:function(){var t=this,i=t.get("viewWidth"),a=t.get("viewHeight");t.container.css({position:"relative",width:i||t.container.width(),height:a||t.container.height()}),t.container.html("").append(t.canvas.css({position:"absolute"})),t.canvas[0].width=t.canvasW=i,t.canvas[0].height=t.canvasH=a},_rejustSize:function(t,i,a,e){var n,s;return t/a>i/e?(n=a,s=n*i/t):(s=e,n=s*t/i),{w:n,h:s,x:(a-n)/2,y:(e-s)/2}},draw:function(t,i,a,e,n){var s=this;s.ctx.clearRect(0,0,s.canvasW,s.canvasH);var c={x:Math.floor(t*n),y:Math.floor(i*n),w:Math.floor(a*n),h:Math.floor(e*n)},h=s._rejustSize(c.w,c.h,s.canvasW,s.canvasH);s.ctx.drawImage(s.get("image"),c.x,c.y,c.w,c.h,h.x,h.y,h.w,h.h)},destroy:function(){this.canvas.remove()}},{ATTRS:{previewEl:{value:""},viewHeight:{value:100},viewWidth:{value:100},image:{value:null}}})});