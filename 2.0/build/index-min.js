/*! imgcrop - v2.0 - 2013-05-01 6:43:24 PM
* Copyright (c) 2013 元泉; Licensed  */
KISSY.add("gallery/imgcrop/2.0/imgcrop-canvas",function(t){function e(t,i,e,s){this.x=t,this.y=i,this.w=e,this.h=s,this.px=0,this.py=0,this.csize=5,this.csizeh=6,this.bHover=[!1,!1,!1,!1],this.iCSize=[this.csize,this.csize,this.csize,this.csize],this.bDrag=[!1,!1,!1,!1],this.bDragAll=!1}function s(){s.superclass.constructor.apply(this,arguments),this.container=h(this.get("areaEl")),this.canvas=h("<canvas>"),this.ctx=this.canvas[0].getContext("2d"),this.image=new Image,this.iMouseX=0,this.iMouseY=0,this.theSelection=null,this._init()}var h=t.all;return t.augment(e,{draw:function(t){t.strokeStyle="#fff",t.lineWidth=1,t.strokeRect(this.x,this.y,this.w,this.h),t.fillStyle="#fff",t.fillRect(this.x-this.iCSize[0],this.y-this.iCSize[0],2*this.iCSize[0],2*this.iCSize[0]),t.fillRect(this.x+this.w-this.iCSize[1],this.y-this.iCSize[1],2*this.iCSize[1],2*this.iCSize[1]),t.fillRect(this.x+this.w-this.iCSize[2],this.y+this.h-this.iCSize[2],2*this.iCSize[2],2*this.iCSize[2]),t.fillRect(this.x-this.iCSize[3],this.y+this.h-this.iCSize[3],2*this.iCSize[3],2*this.iCSize[3])},getInfo:function(){return{x:this.x,y:this.y,w:this.w,h:this.h}}}),s.ATTRS={areaEl:{value:""},areaWidth:{value:0},areaHeight:{value:0},url:{value:""},initWidth:{value:100},initHeight:{value:100},resize:{value:!0},scale:{value:!1},opacity:{value:50},color:{value:"#000"},min:{value:!1},minHeight:{value:100},minWidth:{value:100},preview:{value:""},viewHeight:{value:300},viewWidth:{value:300},initialXY:{value:[50,50]}},t.extend(s,t.Base),t.augment(s,t.EventTarget,{_init:function(){var t=this,i=t.image;i.onload=function(){t._build(),t.theSelection=new e(t.get("initialXY")[0],t.get("initialXY")[1],t.get("initWidth"),t.get("initHeight")),t._rejustSize(i.width,i.height,t.container.width(),t.container.height()),t._drawScene(),t._bind(),t.fire("imgload",{width:i.width,height:i.height})},i.src=t.get("url")},_bind:function(){h(document).on("mousemove",this._handleMouseMove,this),this.canvas.on("mousedown",this._handleMouseDown,this),h(document).on("mouseup",this._handleMouseUp,this)},_build:function(){var t=this,i=t.get("areaWidth"),e=t.get("areaHeight");t.container.css({position:"relative",width:i||t.container.width(),height:e||t.container.height()}),t.canvas.css({position:"absolute"}),t.container.append(t.canvas)},_drawScene:function(){var t=this,i=t.ctx,e=t.canvasW,s=t.canvasH,h=t.theSelection;i.clearRect(0,0,e,s),i.drawImage(t.image,0,0,e,s),i.fillStyle="rgba(0, 0, 0, 0.5)",i.fillRect(0,0,e,h.y),i.fillRect(0,h.y,h.x,h.h),i.fillRect(h.x+h.w,h.y,e-h.x-h.w,h.h),i.fillRect(0,h.y+h.h,e,s-h.y-h.h),h.draw(i)},_handleMouseMove:function(t){var e=this;t.preventDefault(),window.getSelection?window.getSelection().removeAllRanges():document.selection.empty();var s=e.iMouseX,h=e.iMouseY,n=e.theSelection,o=e.canvas.offset();for(s=Math.min(Math.max(t.pageX-o.left,0),e.canvasW),h=Math.min(Math.max(t.pageY-o.top,0),e.canvasH),n.bDragAll&&(e.fire("drag",{e:t}),n.x=Math.min(Math.max(s-n.px,0),e.canvasW-n.w),n.y=Math.min(Math.max(h-n.py,0),e.canvasH-n.h)),i=0;4>i;i++)n.bHover[i]=!1,n.iCSize[i]=n.csize;s>n.x-n.csizeh&&n.x+n.csizeh>s&&h>n.y-n.csizeh&&n.y+n.csizeh>h&&(n.bHover[0]=!0,n.iCSize[0]=n.csizeh),s>n.x+n.w-n.csizeh&&n.x+n.w+n.csizeh>s&&h>n.y-n.csizeh&&n.y+n.csizeh>h&&(n.bHover[1]=!0,n.iCSize[1]=n.csizeh),s>n.x+n.w-n.csizeh&&n.x+n.w+n.csizeh>s&&h>n.y+n.h-n.csizeh&&n.y+n.h+n.csizeh>h&&(n.bHover[2]=!0,n.iCSize[2]=n.csizeh),s>n.x-n.csizeh&&n.x+n.csizeh>s&&h>n.y+n.h-n.csizeh&&n.y+n.h+n.csizeh>h&&(n.bHover[3]=!0,n.iCSize[3]=n.csizeh);var a,r,l,c;n.bDrag[0]&&(l=s-n.px,c=h-n.py,a=n.w+n.x-l,r=n.h+n.y-c,e.fire("resize",{e:t})),n.bDrag[1]&&(l=n.x,c=h-n.py,a=s-n.px-l,r=n.h+n.y-c,e.fire("resize",{e:t})),n.bDrag[2]&&(l=n.x,c=n.y,a=s-n.px-l,r=h-n.py-c,e.fire("resize",{e:t})),n.bDrag[3]&&(l=s-n.px,c=n.y,a=n.w+n.x-l,r=h-n.py-c,e.fire("resize",{e:t})),a>e.get("minWidth")&&(n.w=a,n.x=l),r>e.get("minHeight")&&(n.h=r,n.y=c),e._drawScene()},_handleMouseDown:function(t){var e=this,s=e.iMouseX,h=e.iMouseY,n=e.theSelection,o=e.canvas.offset();for(s=Math.floor(t.pageX-o.left),h=Math.floor(t.pageY-o.top),n.px=s-n.x,n.py=h-n.y,n.bHover[0]&&(n.px=s-n.x,n.py=h-n.y),n.bHover[1]&&(n.px=s-n.x-n.w,n.py=h-n.y),n.bHover[2]&&(n.px=s-n.x-n.w,n.py=h-n.y-n.h),n.bHover[3]&&(n.px=s-n.x,n.py=h-n.y-n.h),s>n.x+n.csizeh&&n.x+n.w-n.csizeh>s&&h>n.y+n.csizeh&&n.y+n.h-n.csizeh>h&&(n.bDragAll=!0),i=0;4>i;i++)n.bHover[i]&&(n.bDrag[i]=!0)},_handleMouseUp:function(){var t=this.theSelection;for(t.bDragAll=!1,i=0;4>i;i++)t.bDrag[i]=!1;t.px=0,t.py=0},_rejustSize:function(t,i,e,s){var h,n,o=this;t/e>i/s?(h=Math.min(e,t),n=h*i/t):(n=Math.min(s,i),h=n*t/i),o.canvas[0].width=o.canvasW=h,o.canvas[0].height=o.canvasH=n,o.canvas.css({top:(o.container.height()-o.canvasH)/2,left:(o.container.width()-o.canvasW)/2})},getInfo:function(){return this.theSelection.getInfo()},move:function(){}}),s},{attach:!1}),KISSY.add("gallery/imgcrop/2.0/resizable",function(t){function i(){this.initialize.apply(this,arguments)}var e=t.Event,s=t.DOM;return t.augment(i,{initialize:function(i,h){var n=this;this._obj=s.get(i),this._styleWidth=this._styleHeight=this._styleLeft=this._styleTop=0,this._sideRight=this._sideDown=this._sideLeft=this._sideUp=0,this._fixLeft=this._fixTop=0,this._scaleLeft=this._scaleTop=0,this._mxSet=function(){},this._mxRightWidth=this._mxDownHeight=this._mxUpHeight=this._mxLeftWidth=0,this._mxScaleWidth=this._mxScaleHeight=0,this._fun=function(){},this._borderX=parseInt(s.css(this._obj,"border-left-width"),10)+parseInt(s.css(this._obj,"border-right-width"),10),this._borderY=parseInt(s.css(this._obj,"border-top-width"),10)+parseInt(s.css(this._obj,"border-bottom-width"),10),this.setOptions(h),this.Max=!!this.options.Max,this._mxContainer=s.get(this.options.mxContainer)||null,this.mxLeft=Math.round(this.options.mxLeft),this.mxRight=Math.round(this.options.mxRight),this.mxTop=Math.round(this.options.mxTop),this.mxBottom=Math.round(this.options.mxBottom),this.Min=!!this.options.Min,this.minWidth=Math.round(this.options.minWidth),this.minHeight=Math.round(this.options.minHeight),this.Scale=!!this.options.Scale,this.Ratio=Math.max(this.options.Ratio,0),this._obj.style.position="absolute",this._mxContainer&&s.css(this._mxContainer,"position","relative"),t.each(this.options.Points,function(t,i){(function(t,i){e.on(t,"mousedown",function(t){t.funName=i,n.start(t)})})(t,i)})},setOptions:function(i){this.options={Max:!1,mxContainer:"",mxLeft:0,mxRight:9999,mxTop:0,mxBottom:9999,Min:!1,minWidth:50,minHeight:50,Scale:!1,Ratio:0,Points:{Right:".point-r",Left:".point-l",Up:".point-t",Down:".point-b",RightDown:".point-rb",LeftDown:".point-lb",RightUp:".point-rt",LeftUp:".point-lt"},onResize:function(){},onResizeStart:function(){},onResizeEnd:function(){}},t.mix(this.options,i)},start:function(t){if(t.halt(),this._fun=this[t.funName],this._styleWidth=this._obj.clientWidth,this._styleHeight=this._obj.clientHeight,this._styleLeft=this._obj.offsetLeft,this._styleTop=this._obj.offsetTop,this._sideLeft=t.clientX-this._styleWidth,this._sideRight=t.clientX+this._styleWidth,this._sideUp=t.clientY-this._styleHeight,this._sideDown=t.clientY+this._styleHeight,this._fixLeft=this._styleLeft+this._styleWidth,this._fixTop=this._styleTop+this._styleHeight,this.Scale&&(this.Ratio=this._styleWidth/this._styleHeight,this._scaleLeft=this._styleLeft+this._styleWidth/2,this._scaleTop=this._styleTop+this._styleHeight/2),this.Max){var i=this.mxLeft,s=this.mxRight,h=this.mxTop,n=this.mxBottom;this._mxContainer&&(i=Math.max(i,0),h=Math.max(h,0),s=Math.min(s,this._mxContainer.clientWidth),n=Math.min(n,this._mxContainer.clientHeight)),s=Math.max(s,i+(this.Min?this.minWidth:0)+this._borderX),n=Math.max(n,h+(this.Min?this.minHeight:0)+this._borderY),this._mxSet=function(){this._mxRightWidth=s-this._styleLeft-this._borderX,this._mxDownHeight=n-this._styleTop-this._borderY,this._mxUpHeight=Math.max(this._fixTop-h,this.Min?this.minHeight:0),this._mxLeftWidth=Math.max(this._fixLeft-i,this.Min?this.minWidth:0)},this._mxSet(),this.Scale&&(this._mxScaleWidth=2*Math.min(this._scaleLeft-i,s-this._scaleLeft-this._borderX),this._mxScaleHeight=2*Math.min(this._scaleTop-h,n-this._scaleTop-this._borderY))}e.on(document,"mousemove",this.resize,this),e.on(document,"mouseup",this.stop,this),this.options.onResizeStart(t)},stop:function(t){e.detach(document,"mousemove",this.resize,this),e.detach(document,"mouseup",this.stop,this),this.options.onResizeEnd(t)},resize:function(t){window.getSelection?window.getSelection().removeAllRanges():document.selection.empty(),this._fun(t),this._obj.style.width=this._styleWidth+"px",this._obj.style.height=this._styleHeight+"px",this._obj.style.top=this._styleTop+"px",this._obj.style.left=this._styleLeft+"px",this.options.onResize(t)},Up:function(t){this.RepairY(this._sideDown-t.clientY,this._mxUpHeight),this.RepairTop(),this.TurnDown(this.Down)},Down:function(t){this.RepairY(t.clientY-this._sideUp,this._mxDownHeight),this.TurnUp(this.Up)},Right:function(t){this.RepairX(t.clientX-this._sideLeft,this._mxRightWidth),this.TurnLeft(this.Left)},Left:function(t){this.RepairX(this._sideRight-t.clientX,this._mxLeftWidth),this.RepairLeft(),this.TurnRight(this.Right)},RightDown:function(t){this.RepairAngle(t.clientX-this._sideLeft,this._mxRightWidth,t.clientY-this._sideUp,this._mxDownHeight),this.TurnLeft(this.LeftDown)||this.TurnUp(this.RightUp)},RightUp:function(t){this.RepairAngle(t.clientX-this._sideLeft,this._mxRightWidth,this._sideDown-t.clientY,this._mxUpHeight),this.RepairTop(),this.TurnLeft(this.LeftUp)||this.TurnDown(this.RightDown)},LeftDown:function(t){this.RepairAngle(this._sideRight-t.clientX,this._mxLeftWidth,t.clientY-this._sideUp,this._mxDownHeight),this.RepairLeft(),this.TurnRight(this.RightDown)||this.TurnUp(this.LeftUp)},LeftUp:function(t){this.RepairAngle(this._sideRight-t.clientX,this._mxLeftWidth,this._sideDown-t.clientY,this._mxUpHeight),this.RepairTop(),this.RepairLeft(),this.TurnRight(this.RightUp)||this.TurnDown(this.LeftDown)},RepairX:function(t,i){if(t=this.RepairWidth(t,i),this.Scale){var e=Math.round(t/this.Ratio);if(this.Max&&e>this._mxScaleHeight)t=Math.round((e=this._mxScaleHeight)*this.Ratio);else if(this.Min&&this.minHeight>e){var s=Math.round(this.minHeight*this.Ratio);i>s&&(e=this.minHeight,t=s)}this._styleHeight=e,this._styleTop=this._scaleTop-e/2}this._styleWidth=t},RepairY:function(t,i){if(t=this.RepairHeight(t,i),this.Scale){var e=Math.round(t*this.Ratio);if(this.Max&&e>this._mxScaleWidth)t=Math.round((e=this._mxScaleWidth)/this.Ratio);else if(this.Min&&this.minWidth>e){var s=Math.round(this.minWidth/this.Ratio);i>s&&(e=this.minWidth,t=s)}this._styleWidth=e,this._styleLeft=this._scaleLeft-e/2}this._styleHeight=t},RepairAngle:function(t,i,e,s){if(t=this.RepairWidth(t,i),this.Scale){if(e=Math.round(t/this.Ratio),this.Max&&e>s)t=Math.round((e=s)*this.Ratio);else if(this.Min&&this.minHeight>e){var h=Math.round(this.minHeight*this.Ratio);i>h&&(e=this.minHeight,t=h)}}else e=this.RepairHeight(e,s);this._styleWidth=t,this._styleHeight=e},RepairTop:function(){this._styleTop=this._fixTop-this._styleHeight},RepairLeft:function(){this._styleLeft=this._fixLeft-this._styleWidth},RepairHeight:function(t,i){return t=Math.min(this.Max?i:t,t),t=Math.max(this.Min?this.minHeight:t,t,0)},RepairWidth:function(t,i){return t=Math.min(this.Max?i:t,t),t=Math.max(this.Min?this.minWidth:t,t,0)},TurnRight:function(t){return this.Min||this._styleWidth?void 0:(this._fun=t,this._sideLeft=this._sideRight,this.Max&&this._mxSet(),!0)},TurnLeft:function(t){return this.Min||this._styleWidth?void 0:(this._fun=t,this._sideRight=this._sideLeft,this._fixLeft=this._styleLeft,this.Max&&this._mxSet(),!0)},TurnUp:function(t){return this.Min||this._styleHeight?void 0:(this._fun=t,this._sideDown=this._sideUp,this._fixTop=this._styleTop,this.Max&&this._mxSet(),!0)},TurnDown:function(t){return this.Min||this._styleHeight?void 0:(this._fun=t,this._sideUp=this._sideDown,this.Max&&this._mxSet(),!0)}}),i},{attach:!1}),KISSY.add("gallery/imgcrop/2.0/dragable",function(t){function i(){this.initialize.apply(this,arguments)}var e=t.Event,s=t.DOM;return t.UA.ie,t.augment(i,{initialize:function(t,i){this.Drag=s.get(t),this._x=this._y=0,this._marginLeft=this._marginTop=0,this.setOptions(i),this.Limit=!!this.options.Limit,this.mxLeft=parseInt(this.options.mxLeft),this.mxRight=parseInt(this.options.mxRight),this.mxTop=parseInt(this.options.mxTop),this.mxBottom=parseInt(this.options.mxBottom),this.LockX=!!this.options.LockX,this.LockY=!!this.options.LockY,this.Lock=!!this.options.Lock,this._Handle=s.get(this.options.Handle)||this.Drag,this._mxContainer=s.get(this.options.mxContainer)||null,this._Handle.style.position="absolute",this.Repair(),e.on(this._Handle,"mousedown",this.start,this)},setOptions:function(i){this.options={Handle:"",Limit:!0,mxLeft:0,mxRight:9999,mxTop:0,mxBottom:9999,mxContainer:"",LockX:!1,LockY:!1,Lock:!1,Transparent:!0,onstart:function(){},onmove:function(){},onstop:function(){}},t.mix(this.options,i)},start:function(t){t.preventDefault(),this.Lock||(this.Repair(),this._x=t.clientX-this.Drag.offsetLeft,this._y=t.clientY-this.Drag.offsetTop,this._marginLeft=parseInt(s.css(this.Drag,"margin-left"),10)||this._marginLeft,this._marginTop=parseInt(s.css(this.Drag,"margin-top"),10)||this._marginTop,e.on(document,"mousemove",this.move,this),e.on(document,"mouseup",this.stop,this),this.options.onstart(t))},stop:function(t){e.detach(document,"mousemove",this.move,this),e.detach(document,"mouseup",this.stop,this),this.options.onstop(t)},Repair:function(){this.Limit&&(this.mxRight=Math.max(this.mxRight,this.mxLeft+this.Drag.offsetWidth),this.mxBottom=Math.max(this.mxBottom,this.mxTop+this.Drag.offsetHeight),this._mxContainer&&s.css(this._mxContainer,"position","relative"))},move:function(t){if(this.Lock)return this.stop(),void 0;window.getSelection?window.getSelection().removeAllRanges():document.selection.empty();var i=t.clientX-this._x,e=t.clientY-this._y;if(this.Limit){var s=this.mxLeft,h=this.mxRight,n=this.mxTop,o=this.mxBottom;this._mxContainer&&(s=Math.max(s,0),n=Math.max(n,0),h=Math.min(h,this._mxContainer.clientWidth),o=Math.min(o,this._mxContainer.clientHeight)),i=Math.max(Math.min(i,h-this.Drag.offsetWidth),s),e=Math.max(Math.min(e,o-this.Drag.offsetHeight),n)}this.LockX||(this.Drag.style.left=i-this._marginLeft+"px"),this.LockY||(this.Drag.style.top=e-this._marginTop+"px"),this.options.onmove(t)}}),i},{attach:!1}),KISSY.add("gallery/imgcrop/2.0/imgcrop-normal",function(t,i,e){function s(){s.superclass.constructor.apply(this,arguments),this._init()}var h=t.all,n=t.Event,o=t.DOM;return s.ATTRS={areaEl:{value:""},areaWidth:{value:0},areaHeight:{value:0},url:{value:""},initWidth:{value:100},initHeight:{value:100},resize:{value:!0},scale:{value:!1},opacity:{value:50},color:{value:"#000"},min:{value:!1},minHeight:{value:100},minWidth:{value:100},preview:{value:""},viewHeight:{value:300},viewWidth:{value:300},initialXY:{value:[50,50]}},t.extend(s,t.Base,{_init:function(){var t=this;t._render(),t._bind()},_bind:function(){var t=this;t.on("*Change",function(){t._loadImage()}),n.on(t._tempImg,"load",t._onImgLoad,t)},_render:function(){var t=this;t.area=h(t.get("areaEl")).css("overflow","hidden").html(""),t.preview=h(t.get("preview")).html(""),t.area.css("position","relative"),t.wrap=h('<div class="crop-wrap">'),t.wrap.append(t._createDragEl()).appendTo(t.area),t.get("areaWidth")?t.area.width(t.get("areaWidth")):t.set("areaWidth",t.area.width()),t.get("areaHeight")?t.area.height(t.get("areaHeight")):t.set("areaHeight",t.area.height()),t._layBase=new Image,t._layCropper=new Image,t._tempImg=new Image,t.wrap.append(t._layBase).append(t._layCropper),t._setPreview(),t._loadImage()},_createDragEl:function(){var i=this,e=i.el=h('<div class="crop">');return i.get("resize")&&t.each(["lt","t","rt","r","rb","b","lb","l"],function(t){e.append(h('<div class="crop-point point-'+t+'">'))}),e.css({position:"absolute",left:i.get("initialXY")[0],top:i.get("initialXY")[1],width:i.get("initWidth"),height:i.get("initHeight"),display:"none"}),e},_loadImage:function(){var i=this;i._layBase.style.visibility=i._layCropper.style.visibility="hidden",i._tempImg.src=i._layBase.src=i._layCropper.src=i.get("url")+"?nocache="+t.guid(),i._view&&(i._view.src=i._tempImg.src)},_onImgLoad:function(){this._initStyle(),this._setImgSize(),this._setPos(),this._initDrag(),this._initResize()},_initDrag:function(){var t=this;t._drag=new e(t.el,{Max:!0,mxContainer:t.wrap,onstart:function(i){t.fire("dragstart",i)},onmove:function(i){t._setPos(),t.fire("drag",i)},onstop:function(i){t.fire("dragend",i)}})},_initResize:function(){var t=this;t.get("resize")&&(t._resize=new i(t.el,{Max:!0,Min:t.get("min"),Scale:t.get("scale"),Ratio:t.get("ratio"),minWidth:t.get("minWidth"),minHeight:t.get("minHeight"),mxContainer:t.wrap,onResize:function(i){t._setPos(),t.fire("resize",i)},onResizeStart:function(i){t.fire("resizestart",i)},onResizeEnd:function(i){t.fire("resizeend",i)}}))},_initStyle:function(){var t=this;t.wrap.css({position:"relative",overflow:"hidden",background:t.get("color")}),t.el.css("z-index",200),o.css(t._layCropper,{zIndex:100,position:"absolute",top:0,left:0}),o.css(t._layBase,{position:"absolute",opacity:t.get("opacity")/100,top:0,left:0})},_adjustPos:function(){var t=this,i=t._getPos(),e=t.wrap.width(),s=t.wrap.height();i.x+i.w>e&&t.el.width(e-i.x),i.y+i.h>s&&t.el.height(s-i.y)},_setPos:function(){var t=this;t.el.css("zoom",.5),t.el.css({zoom:1,display:"block"}),t._adjustPos();var i=t._getPos();t._layCropper.style.clip="rect("+i.y+"px "+(i.x+i.w)+"px "+(i.y+i.h)+"px "+i.x+"px)",t._view&&t._setPrePos()},_setPreview:function(){var i=this,e=t.one(i.get("preview"));e&&(i._view=new Image,i._view.style.position="absolute",e.append(i._view),e.css({position:"relative",overflow:"hidden"}))},_setPrePos:function(){var t=this,i=t._getPos(),e=t._getSize(i.w,i.h,t.get("viewWidth")||o.width(preWrap),t.get("viewHeight")||o.height(preWrap)),s=e.height/i.h,h=i.y*s,n=i.x*s;o.css(t._view,{width:t._layBase.width*s,height:t._layBase.height*s,top:-h,left:-n,clip:"rect("+h+"px "+(n+e.width)+"px "+(h+e.height)+"px "+n+"px)"})},_getSize:function(t,i,e,s){var h,n,o=1*t,a=1*i;return o/e>a/s?(h=Math.min(e,o),n=h*a/o):(n=Math.min(s,a),h=n*o/a),{width:h,height:n}},_setImgSize:function(){var t=this,i=t._getSize(t._tempImg.width,t._tempImg.height,t.get("areaWidth"),t.get("areaHeight"));return t._layBase.style.width=t._layCropper.style.width=i.width+"px",t._layBase.style.height=t._layCropper.style.height=i.height+"px",t.wrap.css({position:"absolute",width:i.width,height:i.height,top:(t.area.height()-i.height)/2,left:(t.area.width()-i.width)/2}),t._layBase.style.visibility=t._layCropper.style.visibility="visible",t.fire("imgload",{width:i.width,height:i.height}),i},_getPos:function(){return{y:parseFloat(this.el.css("top")),x:parseFloat(this.el.css("left")),w:parseFloat(this.el.css("width")),h:parseFloat(this.el.css("height"))}},getCurSize:function(){return this._getSize(this._tempImg.width,this._tempImg.height,this.get("areaWidth"),this.get("areaHeight"))},getOriSize:function(){return{width:parseInt(this._tempImg.width,10),height:parseInt(this._tempImg.height,10)}},getInfo:function(){var t=this._getPos(),i=parseInt(this._tempImg.width,10)/parseInt(this._layBase.width,10),e={y:t.y,x:t.x,w:t.w,h:t.h,r:i,src:this.get("url")};return e},resetCrop:function(t,i,e,s){this.el.css({width:e,height:s,top:i,left:t}),this._setPos()},show:function(){this.area.show()},hide:function(){this.area.hide()},destroy:function(){n.remove(this.area),this.area.html(""),this.preview.html("");for(var t in this)this.hasOwnProperty(t)&&delete this[t]}}),s},{attach:!1,requires:["./resizable","./dragable"]}),KISSY.add("gallery/imgcrop/2.0/index",function(t,i){function e(t){return new i(t)}return e},{requires:["getContext"in document.createElement("canvas")?"./imgcrop-canvas":"./imgcrop-normal"]});