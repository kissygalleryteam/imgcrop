KISSY.add("kg/imgcrop/2.0.1/lib/normal/resizable",["event","dom"],function(t,i,s,h){"use strict";function e(){this.initialize.apply(this,arguments)}var n=i("event"),o=i("dom");e.prototype={initialize:function(i,s){var h=this;this._obj=o.get(i),this._styleWidth=this._styleHeight=this._styleLeft=this._styleTop=0,this._sideRight=this._sideDown=this._sideLeft=this._sideUp=0,this._fixLeft=this._fixTop=0,this._scaleLeft=this._scaleTop=0,this._mxSet=function(){},this._mxRightWidth=this._mxDownHeight=this._mxUpHeight=this._mxLeftWidth=0,this._mxScaleWidth=this._mxScaleHeight=0,this._fun=function(){},this._borderX=parseInt(o.css(this._obj,"border-left-width"),10)+parseInt(o.css(this._obj,"border-right-width"),10),this._borderY=parseInt(o.css(this._obj,"border-top-width"),10)+parseInt(o.css(this._obj,"border-bottom-width"),10),this.setOptions(s),this.Max=!!this.options.Max,this._mxContainer=o.get(this.options.mxContainer)||null,this.mxLeft=Math.round(this.options.mxLeft),this.mxRight=Math.round(this.options.mxRight),this.mxTop=Math.round(this.options.mxTop),this.mxBottom=Math.round(this.options.mxBottom),this.Min=!!this.options.Min,this.minWidth=Math.round(this.options.minWidth),this.minHeight=Math.round(this.options.minHeight),this.Scale=!!this.options.Scale,this.Ratio=Math.max(this.options.Ratio,0),this._obj.style.position="absolute",this._mxContainer&&o.css(this._mxContainer,"position","relative"),t.each(this.options.Points,function(t,i){!function(t,i){n.on(t,"mousedown",function(t){t.funName=i,h.start(t)})}(t,i)})},setOptions:function(i){this.options={Max:!1,mxContainer:"",mxLeft:0,mxRight:9999,mxTop:0,mxBottom:9999,Min:!1,minWidth:50,minHeight:50,Scale:!1,Ratio:0,Points:{Right:".cubes-t",Left:".cubes-t",Up:".cubes-t",Down:".cubes-t",RightDown:".cubes-rb",LeftDown:".cubes-lb",RightUp:".cubes-rt",LeftUp:".cubes-lt"},onResize:function(){},onResizeStart:function(){},onResizeEnd:function(){}},t.mix(this.options,i)},start:function(t){if(t.halt(),this._fun=this[t.funName],this._styleWidth=this._obj.clientWidth,this._styleHeight=this._obj.clientHeight,this._styleLeft=this._obj.offsetLeft,this._styleTop=this._obj.offsetTop,this._sideLeft=t.clientX-this._styleWidth,this._sideRight=t.clientX+this._styleWidth,this._sideUp=t.clientY-this._styleHeight,this._sideDown=t.clientY+this._styleHeight,this._fixLeft=this._styleLeft+this._styleWidth,this._fixTop=this._styleTop+this._styleHeight,this.Scale&&(this.Ratio=this._styleWidth/this._styleHeight,this._scaleLeft=this._styleLeft+this._styleWidth/2,this._scaleTop=this._styleTop+this._styleHeight/2),this.Max){var i=this.mxLeft,s=this.mxRight,h=this.mxTop,e=this.mxBottom;this._mxContainer&&(i=Math.max(i,0),h=Math.max(h,0),s=Math.min(s,this._mxContainer.clientWidth),e=Math.min(e,this._mxContainer.clientHeight)),s=Math.max(s,i+(this.Min?this.minWidth:0)+this._borderX),e=Math.max(e,h+(this.Min?this.minHeight:0)+this._borderY),this._mxSet=function(){this._mxRightWidth=s-this._styleLeft-this._borderX,this._mxDownHeight=e-this._styleTop-this._borderY,this._mxUpHeight=Math.max(this._fixTop-h,this.Min?this.minHeight:0),this._mxLeftWidth=Math.max(this._fixLeft-i,this.Min?this.minWidth:0)},this._mxSet(),this.Scale&&(this._mxScaleWidth=2*Math.min(this._scaleLeft-i,s-this._scaleLeft-this._borderX),this._mxScaleHeight=2*Math.min(this._scaleTop-h,e-this._scaleTop-this._borderY))}n.on(document,"mousemove",this.resize,this),n.on(document,"mouseup",this.stop,this),this.options.onResizeStart(t)},stop:function(t){n.detach(document,"mousemove",this.resize,this),n.detach(document,"mouseup",this.stop,this),this.options.onResizeEnd(t)},resize:function(t){window.getSelection?window.getSelection().removeAllRanges():document.selection.empty(),this._fun(t),this._obj.style.width=this._styleWidth+"px",this._obj.style.height=this._styleHeight+"px",this._obj.style.top=this._styleTop+"px",this._obj.style.left=this._styleLeft+"px",this.options.onResize(t)},Up:function(t){this.RepairY(this._sideDown-t.clientY,this._mxUpHeight),this.RepairTop(),this.TurnDown(this.Down)},Down:function(t){this.RepairY(t.clientY-this._sideUp,this._mxDownHeight),this.TurnUp(this.Up)},Right:function(t){this.RepairX(t.clientX-this._sideLeft,this._mxRightWidth),this.TurnLeft(this.Left)},Left:function(t){this.RepairX(this._sideRight-t.clientX,this._mxLeftWidth),this.RepairLeft(),this.TurnRight(this.Right)},RightDown:function(t){this.RepairAngle(t.clientX-this._sideLeft,this._mxRightWidth,t.clientY-this._sideUp,this._mxDownHeight),this.TurnLeft(this.LeftDown)||this.TurnUp(this.RightUp)},RightUp:function(t){this.RepairAngle(t.clientX-this._sideLeft,this._mxRightWidth,this._sideDown-t.clientY,this._mxUpHeight),this.RepairTop(),this.TurnLeft(this.LeftUp)||this.TurnDown(this.RightDown)},LeftDown:function(t){this.RepairAngle(this._sideRight-t.clientX,this._mxLeftWidth,t.clientY-this._sideUp,this._mxDownHeight),this.RepairLeft(),this.TurnRight(this.RightDown)||this.TurnUp(this.LeftUp)},LeftUp:function(t){this.RepairAngle(this._sideRight-t.clientX,this._mxLeftWidth,this._sideDown-t.clientY,this._mxUpHeight),this.RepairTop(),this.RepairLeft(),this.TurnRight(this.RightUp)||this.TurnDown(this.LeftDown)},RepairX:function(t,i){if(t=this.RepairWidth(t,i),this.Scale){var s=Math.round(t/this.Ratio);if(this.Max&&s>this._mxScaleHeight)t=Math.round((s=this._mxScaleHeight)*this.Ratio);else if(this.Min&&s<this.minHeight){var h=Math.round(this.minHeight*this.Ratio);i>h&&(s=this.minHeight,t=h)}this._styleHeight=s,this._styleTop=this._scaleTop-s/2}this._styleWidth=t},RepairY:function(t,i){if(t=this.RepairHeight(t,i),this.Scale){var s=Math.round(t*this.Ratio);if(this.Max&&s>this._mxScaleWidth)t=Math.round((s=this._mxScaleWidth)/this.Ratio);else if(this.Min&&s<this.minWidth){var h=Math.round(this.minWidth/this.Ratio);i>h&&(s=this.minWidth,t=h)}this._styleWidth=s,this._styleLeft=this._scaleLeft-s/2}this._styleHeight=t},RepairAngle:function(t,i,s,h){if(t=this.RepairWidth(t,i),this.Scale){if(s=Math.round(t/this.Ratio),this.Max&&s>h)t=Math.round((s=h)*this.Ratio);else if(this.Min&&s<this.minHeight){var e=Math.round(this.minHeight*this.Ratio);i>e&&(s=this.minHeight,t=e)}}else s=this.RepairHeight(s,h);this._styleWidth=t,this._styleHeight=s},RepairTop:function(){this._styleTop=this._fixTop-this._styleHeight},RepairLeft:function(){this._styleLeft=this._fixLeft-this._styleWidth},RepairHeight:function(t,i){return t=Math.min(this.Max?i:t,t),t=Math.max(this.Min?this.minHeight:t,t,0)},RepairWidth:function(t,i){return t=Math.min(this.Max?i:t,t),t=Math.max(this.Min?this.minWidth:t,t,0)},TurnRight:function(t){return this.Min||this._styleWidth?void 0:(this._fun=t,this._sideLeft=this._sideRight,this.Max&&this._mxSet(),!0)},TurnLeft:function(t){return this.Min||this._styleWidth?void 0:(this._fun=t,this._sideRight=this._sideLeft,this._fixLeft=this._styleLeft,this.Max&&this._mxSet(),!0)},TurnUp:function(t){return this.Min||this._styleHeight?void 0:(this._fun=t,this._sideDown=this._sideUp,this._fixTop=this._styleTop,this.Max&&this._mxSet(),!0)},TurnDown:function(t){return this.Min||this._styleHeight?void 0:(this._fun=t,this._sideUp=this._sideDown,this.Max&&this._mxSet(),!0)}},h.exports=e});